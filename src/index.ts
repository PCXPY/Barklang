/**
 * @overview generated by ghoti-cli
 * @fileoverview Entry
 */

import generateAst from "./ast/ast";
import excute from "./excute/excute";
import { internalList, internals } from "./excute/list";

import TAst from "./types/ast";
import IBkcOptions, { TCallables } from "./types/callable";
import TExcute from "./types/excute";
import { checkOptionNameSpace, fixOption } from "./util/check";
import { determin, determinReturn } from "./util/determin";


export const bkc = (code: string, optionsE?: IBkcOptions): any => {
    const options: IBkcOptions = fixOption(optionsE);

    if (checkOptionNameSpace(options).length !== 0) {
        throw new Error('initial namespace is occupied exception');
    }

    const ast: TAst = generateAst(code, options);
    const excuted: TExcute = excute(ast, options);

    for (let i of excuted) {
        if (determinReturn(i.value)) {
            return i.arg;
        }
        const func: ((arg: any) => void) | null = determin(i.value, (options.externals as TCallables));

        if (!func) {
            throw new Error('command is not defined exception');
        }

        func(i.arg);
    }

    return void 0;
};

export default bkc;
